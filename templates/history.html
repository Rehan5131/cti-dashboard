<!-- templates/history.html -->
{% extends "base.html" %}
{% block title %}Lookup History{% endblock %}
{% block content %}
<div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-semibold">Lookup History</h2>
  <div class="space-x-2">
    <a href="{{ url_for('history_export') }}" class="bg-blue-600 text-white px-3 py-1 rounded">Export Lookup CSV</a>
    <a href="{{ url_for('export_iocs') }}" class="bg-gray-200 px-3 py-1 rounded">Export IOCs</a>
  </div>
</div>

<div class="bg-white rounded-lg shadow overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-3 py-2 text-left">Query</th>
        <th class="px-3 py-2 text-left">Kind</th>
        <th class="px-3 py-2 text-left">When</th>
        <th class="px-3 py-2 text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for it in lookups %}
      <tr class="border-t">
        <td class="px-3 py-2">{{ it.query }}</td>
        <td class="px-3 py-2">{{ it.kind }}</td>
        <td class="px-3 py-2">{{ it.ts_str }}</td>
        <td class="px-3 py-2">
          <form action="{{ url_for('history_delete') }}" method="post" style="display:inline">
            <input type="hidden" name="_id" value="{{ it._id_str }}">
            <button type="submit" class="text-red-600 hover:underline" onclick="return confirm('Delete this record?')">Delete</button>
          </form>
          <a href="{{ url_for('lookup_result') }}?q={{ it.query | urlencode }}" class="ml-3 text-indigo-600 hover:underline">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
